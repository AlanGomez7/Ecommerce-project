<%- include('../partials/admin-header')%>
    </aside>
    <main class="main-wrap" style="margin-left: 0;">

        <section class="content-main">
            <div class="content-header">
                <div>
                    <h2 class="content-title card-title">Order detail</h2>
                    <p>Details for Order ID: 3453012</p>
                </div>
            </div>
            <div class="card">
                <header class="card-header">
                    <div class="row align-items-center">
                        <div class="col-lg-6 col-md-6 mb-lg-0 mb-15">
                            <span>
                                <i class="material-icons md-calendar_today"></i> <b>Wed, Aug 13, 2020, 4:34PM</b>
                            </span> <br>
                            <small class="text-muted"><%=orderDetails[0].orderId%></small>
                        </div>
                        <div class="col-lg-6 col-md-6 ms-auto text-md-end">
                            <select class="form-select d-inline-block mb-lg-0 mb-15 mw-200">
                                <option>Change status</option>
                                <option>Awaiting payment</option>
                                <option>Confirmed</option>
                                <option>Shipped</option>
                                <option>Delivered</option>
                            </select>
                            <button class="btn btn-primary" onclick="downloadReport('<%=orderDetails[0].deliveryDetails%>', '<%=products%>')">Save</button>
                            <a class="btn btn-secondary print ms-2" href="#"><i
                                    class="icon material-icons md-print"></i></a>
                        </div>
                    </div>
                </header> <!-- card-header end// -->
                <div class="card-body">
                    <div class="row mb-50 mt-20 order-info-wrap">
                        <div class="col-md-4">
                            <article class="icontext align-items-start">
                                <span class="icon icon-sm rounded-circle bg-primary-light">
                                    <i class="text-primary material-icons md-person"></i>
                                </span>
                                <div class="text">
                                    <h6 class="mb-1">Customer</h6>
                                    <p class="mb-1">
                                        <%=orderDetails[0].deliveryDetails.username%> <br> <br> +91
                                            <%=orderDetails[0].deliveryDetails.altMobile%>
                                    </p>
                                    <a href="#">View profile</a>
                                </div>
                            </article>
                        </div> <!-- col// -->
                        <div class="col-md-4">
                            <article class="icontext align-items-start">
                                <span class="icon icon-sm rounded-circle bg-primary-light">
                                    <i class="text-primary material-icons md-local_shipping"></i>
                                </span>
                                <div class="text">
                                    <h6 class="mb-1">Order info</h6>
                                    <p class="mb-1">
                                        Shipping: Fargo express <br> Pay method: <%=orderDetails[0].paymentMethod%> <br>
                                            Status: <%=orderDetails[0].status%>
                                    </p>
                                    <a href="#">Download info</a>
                                </div>
                            </article>
                        </div> <!-- col// -->
                        <div class="col-md-4">
                            <article class="icontext align-items-start">
                                <span class="icon icon-sm rounded-circle bg-primary-light">
                                    <i class="text-primary material-icons md-place"></i>
                                </span>
                                <div class="text">
                                    <h6 class="mb-1">Deliver to</h6>
                                    <p class="mb-1">
                                        City: <%=orderDetails[0].deliveryDetails.district%>,
                                            <%=orderDetails[0].deliveryDetails.state%> <br>
                                                <%=orderDetails[0].deliveryDetails.address%> <br> Po Box:
                                                    <%=orderDetails[0].deliveryDetails.postalCode%>
                                    </p>
                                    <a href="#">View profile</a>
                                </div>
                            </article>
                        </div> <!-- col// -->
                    </div> <!-- row // -->
                    <div class="row">
                        <div class="col-lg-7">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th width="40%">Product</th>
                                            <th width="20%">Unit Price</th>
                                            <th width="20%">Quantity</th>
                                            <th width="20%">Total</th>
                                            <th width="20%">Status</th>
                                            <th width="10%" class="text-end">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <%products.forEach((cartProducts)=>{%>
                                            <tr>
                                                <td>
                                                    <a class="itemside" href="#">
                                                        <div class="left">
                                                            <img src="<%=cartProducts.product.image[0]%>" width="40"
                                                                height="40" class="img-xs" alt="Item">
                                                        </div>
                                                        <div class="info">
                                                            <%=cartProducts.product.title%>
                                                        </div>
                                                    </a>
                                                </td>
                                                <td> $<%=cartProducts.product.price%>
                                                </td>
                                                <td>
                                                    <%=cartProducts.quantity%>
                                                </td>
                                                <td> $<%=cartProducts.quantity * cartProducts.product.price%>
                                                </td>
                                                <td class="text-warning">
                                                    <%=orderDetails[0].status%>
                                                </td>
                                                <td class="text-end"> 
                                                    <button class="btn btn-danger btn-sm text-light" id="order"
                                                        onclick="cancelOrder('<%=cartProducts._id%>')">
                                                        Cancel
                                                    </button>
                                                    <button class="btn btn-danger btn-sm text-light" id="delivery-order"
                                                        onclick="deliveredOrder('<%=cartProducts._id%>')">
                                                        Delivered
                                                    </button>
                                                </td>
                                            </tr>
                                            <%})%>
                                    </tbody>

                                </table>
                            </div> <!-- table-responsive// -->
                        </div> <!-- col// -->
                        <div class="col-lg-1"></div>
                        <div class="col-lg-4">
                            <div class="box shadow-sm bg-light">
                                <h6 class="mb-15">Payment info</h6>
                                <p>
                                    <img src="assets/imgs/card-brands/2.png" class="border" height="20"> Master Card
                                    **** **** 4768 <br>
                                    Business name: Grand Market LLC <br>
                                    Phone: +1 (800) 555-154-52
                                </p>
                            </div>
                            <div class="h-25 pt-4">
                                <div class="mb-3">
                                    <label>Notes</label>
                                    <textarea class="form-control" name="notes" id="notes"
                                        placeholder="Type some note"></textarea>
                                </div>
                                <button class="btn btn-primary">Save note</button>
                            </div>
                        </div> <!-- col// -->
                    </div>
                </div> <!-- card-body end// -->
            </div> <!-- card end// -->
        </section> <!-- content-main end// -->
        <footer class="main-footer font-xs">
            <div class="row pb-30 pt-15">
                <div class="col-sm-6">
                    <script data-cfasync="false"
                        src="../../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
                    <script>
                        document.write(new Date().getFullYear())
                    </script> ©, Evara - HTML Ecommerce Template .
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end">
                        All rights reserved
                    </div>
                </div>
            </div>
        </footer>
    </main>
    <script src="assets/js/vendors/jquery-3.6.0.min.js"></script>
    <script src="assets/js/vendors/bootstrap.bundle.min.js"></script>
    <script src="assets/js/vendors/select2.min.js"></script>
    <script src="assets/js/vendors/perfect-scrollbar.js"></script>
    <script src="assets/js/vendors/jquery.fullscreen.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Main Script -->
    <script src="https://cdn.jsdelivr.net/npm/easyinvoice/dist/easyinvoice.min.js"></script>
    <script src="assets/js/main.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        function cancelOrder(orderId) {
            document.getElementById('order').addEventListener('click', (e) => {
                Swal.fire({
                    title: 'Are you sure?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        fetch('/admin/cancel-order/' + orderId, {
                            method: 'PATCH',
                            body: JSON.stringify(orderId),
                            Headers: {
                                "Content-type": "application/json; charset=UTF-8"
                            }
                        }).then((response) => {
                            if (response.status === 200) {
                                location.reload();
                            }
                        })

                    }
                })
            })
        }

        function downloadReport(orderDetails, products) {
            console.log(orderDetails.username, products);
            
            var data = {
                // Customize enables you to provide your own templates
                // Please review the documentation for instructions and examples
                "customize": {
                    //  "template": fs.readFileSync('template.html', 'base64') // Must be base64 encoded html 
                },
                "images": {
                    // The logo on top of your invoice
                    "logo": "https://public.easyinvoice.cloud/img/logo_en_original.png",
                    // The invoice background
                    "background": "https://public.easyinvoice.cloud/img/watermark-draft.jpg"
                },
                // Your own data
                "sender": {
                    "company": "Shoppers",
                    "address": "Sample Street 123",
                    "zip": "688007",
                    "city": "Kerala",
                    "country": "India"
                },
                // Your recipient
                "client": {
                    "company": "Client Corp",
                    "address": "Clientstreet 456",
                    "zip": "4567 CD",
                    "city": "Clientcity",
                    "country": "Clientcountry"
                    // "custom1": "custom value 1",
                    // "custom2": "custom value 2",
                    // "custom3": "custom value 3"
                },
                "information": {
                    // Invoice number
                    "number": "2021.0001",
                    // Invoice data
                    "date": "12-12-2021",
                    // Invoice due date
                    "due-date": "31-12-2021"
                },
                // The products you would like to see on your invoice
                // Total values are being calculated automatically
                "products": [
                    {
                        "quantity": 2,
                        "description": "Product 1",
                        "tax-rate": 6,
                        "price": 33.87
                    },
                    {
                        "quantity": 4.1,
                        "description": "Product 2",
                        "tax-rate": 6,
                        "price": 12.34
                    },
                    {
                        "quantity": 4.5678,
                        "description": "Product 3",
                        "tax-rate": 21,
                        "price": 6324.453456
                    }
                ],
                // The message you would like to display on the bottom of your invoice
                "bottom-notice": "Kindly pay your invoice within 15 days.",
                // Settings to customize your invoice
                "settings": {
                    "currency": "USD", // See documentation 'Locales and Currency' for more info. Leave empty for no currency.
                    // "locale": "nl-NL", // Defaults to en-US, used for number formatting (See documentation 'Locales and Currency')        
                    // "margin-top": 25, // Defaults to '25'
                    // "margin-right": 25, // Defaults to '25'
                    // "margin-left": 25, // Defaults to '25'
                    // "margin-bottom": 25, // Defaults to '25'
                    // "format": "A4", // Defaults to A4, options: A3, A4, A5, Legal, Letter, Tabloid
                    // "height": "1000px", // allowed units: mm, cm, in, px
                    // "width": "500px", // allowed units: mm, cm, in, px
                    // "orientation": "landscape", // portrait or landscape, defaults to portrait
                },
                // Translate your invoice to your preferred language
                "translate": {
                    // "invoice": "FACTUUR",  // Default to 'INVOICE'
                    // "number": "Nummer", // Defaults to 'Number'
                    // "date": "Datum", // Default to 'Date'
                    // "due-date": "Verloopdatum", // Defaults to 'Due Date'
                    // "subtotal": "Subtotaal", // Defaults to 'Subtotal'
                    // "products": "Producten", // Defaults to 'Products'
                    // "quantity": "Aantal", // Default to 'Quantity'
                    // "price": "Prijs", // Defaults to 'Price'
                    // "product-total": "Totaal", // Defaults to 'Total'
                    // "total": "Totaal", // Defaults to 'Total'
                    // "vat": "btw" // Defaults to 'vat'
                },
            };

            //Create your invoice! Easy!
            easyinvoice.createInvoice(data, function (result) {
                //The response will contain a base64 encoded PDF file
                console.log('PDF base64 string: ', result.pdf);
                easyinvoice.download("result.pdf")
            });
        }

        function deliveredOrder(orderId) {
            document.getElementById('delivery-order').addEventListener('click', (e) => {
                Swal.fire({
                    title: 'Are you sure?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        fetch('/admin/delivered-order/' + orderId, {
                            method: 'PATCH',
                            body: JSON.stringify(orderId),
                            Headers: {
                                "Content-type": "application/json; charset=UTF-8"
                            }
                        }).then((response) => {
                            if (response.status === 200) {
                                location.reload();
                            }
                        })
                    }
                })
            })
        }
    </script>
    </body>
    <!-- Mirrored from wp.alithemes.com/html/evara/evara-backend/page-orders-detail.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 01 Aug 2021 15:33:22 GMT -->

    </html>